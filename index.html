<!DOCTYPE html>
<html lang="en">
<head>
  <!-- BUILD: DVA index v11 -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <meta name="description" content="Strategic AWS Certified Developer Associate DVA-C02 Exam Trainer - Master timing and pass the exam" />
  <meta name="theme-color" content="#FF9900" media="(prefers-color-scheme: light)" />
  <meta name="theme-color" content="#232F3E" media="(prefers-color-scheme: dark)" />
  <link rel="manifest" href="./manifest.json?v=11" />
  <title>AWS DVA-C02 Strategic Exam Trainer</title>
  <style>
    /* ===== Polished, contained look (matching your previous style) ===== */
    *{margin:0;padding:0;box-sizing:border-box}
    :root{
      --primary:#FF9900;--primary-dark:#FF6600;--primary-light:#FFB84D;
      --success:#28a745;--warning:#ffc107;--danger:#dc3545;--aws-blue:#0073bb;
      --text-white:#fff;--text-light:rgba(255,255,255,.95);
      --card-bg:rgba(255,255,255,.1);--card-hover:rgba(255,255,255,.2)
    }
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,sans-serif;
      min-height:100vh;background:linear-gradient(135deg,#FF6B6B 0%,#FF8787 100%);
      display:flex;flex-direction:column;align-items:center;overflow-x:hidden
    }
    .main-header{width:100%;text-align:center;padding:40px 20px 30px;background:rgba(0,0,0,.1)}
    .main-header h1{color:var(--text-white);font-size:2.8em;font-weight:800}
    .main-header .tagline{color:var(--text-light);font-size:1.05em;margin-top:8px;opacity:.95}

    .container{width:100%;max-width:1100px;padding:20px}

    .features-card,.mode-card{
      background:var(--card-bg);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);
      border:1px solid rgba(255,255,255,.2);border-radius:20px;box-shadow:0 8px 32px rgba(0,0,0,.15)
    }
    .features-card{padding:26px;margin:18px 0}
    .features-card h3{color:#fff;font-size:1.5em;margin-bottom:6px}
    .features-card .subtitle{color:var(--text-light)}

    .mode-selection{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:20px;margin:20px 0 28px}
    .mode-card{padding:24px;cursor:pointer;transition:transform .2s ease}
    .mode-card:hover{transform:translateY(-6px);background:var(--card-hover)}
    .mode-title{color:#fff;font-size:1.25em;font-weight:800;margin-bottom:6px}
    .mode-desc{color:var(--text-light);font-size:.95em}

    .timer-section{display:none;gap:16px;justify-content:center;margin:6px auto 0;flex-wrap:wrap}
    .timer-box{min-width:170px;background:rgba(255,255,255,.2);border:1px solid rgba(255,255,255,.3);border-radius:14px;padding:14px;text-align:center;box-shadow:0 5px 20px rgba(0,0,0,.1)}
    .timer-label{color:var(--text-light);font-size:.8em;margin-bottom:6px;text-transform:uppercase;letter-spacing:.5px}
    .timer-value{color:#fff;font-size:1.8em;font-weight:800}
    .pace-indicator{margin-top:6px;padding:4px 10px;border-radius:20px;color:#fff;font-weight:800;font-size:.8em}
    .pace-on-track{background:var(--success)}.pace-behind{background:var(--warning)}.pace-danger{background:var(--danger)}

    .question-container{
      display:none;background:#fff;border-radius:20px;padding:28px;margin:18px auto;max-width:1000px;
      color:#333;box-shadow:0 10px 40px rgba(0,0,0,.15)
    }
    .question-header{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;margin-bottom:16px}
    .badge{padding:6px 12px;border-radius:16px;font-size:.85em;font-weight:700}
    .badge-domain{background:var(--primary);color:#fff}
    .badge-difficulty-easy{background:var(--success);color:#fff}
    .badge-difficulty-medium{background:#fd7e14;color:#fff}
    .badge-difficulty-hard{background:var(--danger);color:#fff}
    .scenario{background:#fff5f5;border-left:4px solid var(--primary);padding:14px;border-radius:8px;margin:10px 0 14px;color:#444}
    .question-text{font-size:1.1em;font-weight:700;margin:8px 0 12px;color:#232F3E}

    .options{display:flex;flex-direction:column;gap:10px}
    .option{background:#fff;border:2px solid #e6e6e6;border-radius:10px;padding:12px;cursor:pointer;display:flex;gap:10px;align-items:flex-start;transition:all .15s}
    .option:hover{border-color:#ffb84d;transform:translateX(3px);box-shadow:0 4px 12px rgba(0,0,0,.08)}
    .option.selected{background:#FFF3E0;border-color:#ff9900}
    .option.correct{background:#E8F5E9;border-color:#28a745}
    .option.incorrect{background:#FFEBEE;border-color:#dc3545}
    .option-letter{min-width:28px;height:28px;border-radius:50%;background:var(--aws-blue);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:800}

    .explanation{display:none;margin-top:16px;background:linear-gradient(135deg,#f0f8ff,#f5faff);border:1px solid #d1e7ff;border-radius:12px;padding:18px}
    .controls{display:flex;gap:10px;margin-top:16px}
    .btn{flex:1;padding:12px 18px;border:none;border-radius:24px;color:#fff;font-weight:800;cursor:pointer;letter-spacing:.4px;text-transform:uppercase}
    .btn-primary{background:linear-gradient(135deg,#ff9900,#ff6600)}
    .btn-secondary{background:linear-gradient(135deg,#6c757d,#5a6268)}
    .results-container{display:none;background:#fff;border-radius:20px;padding:28px;margin:18px auto;max-width:1000px;box-shadow:0 10px 40px rgba(0,0,0,.15)}
    .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin:16px 0}
    .stat-card{background:#f8f9fa;border-radius:12px;padding:16px;text-align:center}
    @media (max-width:768px){.controls{flex-direction:column}.btn{width:100%}}
  </style>
</head>
<body>
  <div class="main-header">
    <h1>üéØ AWS DVA-C02 Strategic Exam Trainer</h1>
    <p class="tagline">Master exam timing & strategy with 500+ realistic developer scenarios</p>
  </div>

  <div class="container">
    <div class="features-card">
      <h3>üì¶ Professional Question Bank</h3>
      <p class="subtitle">Security ‚Ä¢ Deployment ‚Ä¢ Performance ‚Ä¢ Cost optimization ‚Ä¢ Best practices</p>
    </div>

    <div class="mode-selection" id="modeSelection">
      <div class="mode-card" onclick="startMode('triage')">
        <div class="mode-title">‚ö° Triage Training</div>
        <p class="mode-desc">30-second decision drills. Build skip/solve instincts.</p>
      </div>
      <div class="mode-card" onclick="startMode('speed')">
        <div class="mode-title">üî• Speed Rounds</div>
        <p class="mode-desc">Hard 90s per question; automatic pace discipline.</p>
      </div>
      <div class="mode-card" onclick="startMode('exam')">
        <div class="mode-title">üéØ Full Exam Simulation</div>
        <p class="mode-desc">65 questions ‚Ä¢ 130-minute global countdown ‚Ä¢ pace coaching.</p>
      </div>
      <div class="mode-card" onclick="startMode('strategic')">
        <div class="mode-title">üß† Strategic Practice</div>
        <p class="mode-desc">Mark / skip / return with flexible timing.</p>
      </div>
    </div>

    <div class="timer-section" id="timerSection">
      <div class="timer-box">
        <div class="timer-label">Global Timer</div>
        <div class="timer-value" id="globalTimer">00:00</div>
      </div>
      <div class="timer-box">
        <div class="timer-label">Question Time</div>
        <div class="timer-value" id="questionTimer">00:00</div>
      </div>
      <div class="timer-box">
        <div class="timer-label">Pace Status</div>
        <div class="timer-value" id="paceValue">--</div>
        <div id="paceIndicator" class="pace-indicator pace-on-track">ON TRACK</div>
      </div>
    </div>

    <div class="question-container" id="questionContainer">
      <div class="question-header">
        <div class="question-info">
          <span class="badge badge-domain" id="domainBadge">Domain</span>
          <span class="badge" id="difficultyBadge">Medium</span>
          <span class="badge" id="questionNumber">Q1 of N</span>
        </div>
        <div class="question-actions" style="display:flex;gap:8px">
          <button class="btn btn-secondary" style="flex:none" onclick="toggleFlag()">üö© Flag</button>
          <button class="btn btn-primary"  style="flex:none" onclick="skipQuestion()">‚è≠Ô∏è Skip</button>
        </div>
      </div>

      <div class="scenario" id="scenario"></div>
      <div class="question-text" id="questionText"></div>
      <div class="options" id="options"></div>

      <div class="explanation" id="explanation">
        <h3>üìö Explanation</h3>
        <div><strong>‚úÖ Correct:</strong> <span id="correctExplanation"></span></div>
        <div style="margin-top:8px"><strong>üí° Tip:</strong> <span id="strategyTip"></span></div>
      </div>

      <div class="controls">
        <button class="btn btn-secondary" onclick="previousQuestion()">Previous</button>
        <button class="btn btn-primary" id="submitBtn" onclick="submitAnswer()">Submit</button>
        <button class="btn btn-primary" id="nextBtn" style="display:none" onclick="nextQuestion()">Next</button>
      </div>
    </div>

    <div class="results-container" id="resultsContainer">
      <h2>üìä Performance Analysis</h2>
      <div class="stats-grid">
        <div class="stat-card"><div>Score</div><div id="scoreText" style="font-size:1.8em;font-weight:800;color:#0073bb">0%</div></div>
        <div class="stat-card"><div>Correct</div><div id="correctCount" style="font-size:1.8em;font-weight:800;color:#0073bb">0/0</div></div>
        <div class="stat-card"><div>Time Used</div><div id="timeUsed" style="font-size:1.8em;font-weight:800;color:#0073bb">00:00</div></div>
        <div class="stat-card"><div>Flagged</div><div id="flaggedCount" style="font-size:1.8em;font-weight:800;color:#0073bb">0</div></div>
      </div>
      <div class="controls">
        <button class="btn btn-primary" onclick="reviewAnswers()">Detailed Review</button>
        <button class="btn btn-secondary" onclick="resetQuiz()">Take Another Exam</button>
      </div>
    </div>
  </div>

  <!-- (Optional) Extension noise blocker -->
  <script>
    (function(){
      const props=['ethereum','tronWeb','solana','walletRouter'];
      try{
        props.forEach(p=>Object.defineProperty(window,p,{get:()=>undefined,set:()=>{},configurable:false}));
      }catch(e){}
    })();
  </script>

  <!-- Load your bank -->
  <script src="./questions.js?v=11"></script>
  <!-- Bridge: if someone wrote 'const questionBank = [...]', promote it -->
  <script>if(typeof window.questionBank==="undefined" && typeof questionBank!=="undefined"){window.questionBank=questionBank}</script>

  <script>
    // ===== Mode configuration =====
    const MODES = {
      triage:    { label:'Triage',     total:24, timePerQ:30,  perQWarn:30,  globalMin:null,  autoAdvance:true,  filter:q=> (q.difficulty||'').toLowerCase()!=='easy' },
      speed:     { label:'Speed',      total:40, timePerQ:90,  perQWarn:90,  globalMin:null,  autoAdvance:true,  filter:null },
      exam:      { label:'Full Exam',  total:65, timePerQ:null, perQWarn:90, globalMin:130,   autoAdvance:false, filter:null }, // no hard per-Q cap
      strategic: { label:'Strategic',  total:30, timePerQ:null, perQWarn:null,globalMin:null, autoAdvance:false, filter:null }
    };

    // ===== State + helpers =====
    const state = {
      mode:null, questions:[], index:0,
      answers:[], correctCount:0, flagged:new Set(), skipped:new Set(),
      startedAt:null, qStartedAt:null, perQTimes:[],
      timers:{ global:null, perQ:null }
    };

    const $ = id => document.getElementById(id);
    const pad2 = n => String(n).padStart(2,'0');
    const fmtSec = s => `${pad2(Math.floor(s/60))}:${pad2(s%60)}`;
    function deltaClock(s){ s=Math.abs(s); const m=(s/60)|0, sec=s%60; return `${m}m ${pad2(sec)}`; }

    function sample(arr,n){
      if(n>=arr.length) return [...arr].sort(()=>Math.random()-0.5);
      const out=[], used=new Set();
      while(out.length<n){ const i=(Math.random()*arr.length)|0; if(!used.has(i)){used.add(i); out.push(arr[i]);} }
      return out;
    }

    function overallDelta(cfg, perQElapsed){
      // target per question = timePerQ (triage/speed) else global average (exam=120s)
      const base = cfg.timePerQ || (cfg.globalMin ? Math.round((cfg.globalMin*60)/state.questions.length) : (cfg.perQWarn||90));
      const answered = state.answers.filter(a=>a!==null).length;
      const expected = answered * base + Math.min(perQElapsed, base);
      const actual = Math.floor((Date.now() - state.startedAt)/1000);
      return actual - expected; // + behind, - ahead
    }

    // ===== Engine =====
    function startMode(modeName){
      if(!Array.isArray(window.questionBank) || !window.questionBank.length){
        alert('Questions not loaded.'); return;
      }
      const cfg = MODES[modeName];
      state.mode = modeName;

      const pool = cfg.filter ? window.questionBank.filter(cfg.filter) : window.questionBank;
      state.questions = sample(pool, cfg.total);
      state.index = 0;
      state.answers = new Array(state.questions.length).fill(null);
      state.correctCount = 0;
      state.flagged.clear(); state.skipped.clear();
      state.perQTimes = new Array(state.questions.length).fill(0);
      state.startedAt = Date.now();

      // UI setup
      $('modeSelection').style.display='none';
      $('timerSection').style.display='flex';
      $('questionContainer').style.display='block';
      $('resultsContainer').style.display='none';
      $('explanation').style.display='none';

      clearInterval(state.timers.global); clearInterval(state.timers.perQ);
      if(cfg.globalMin){
        const end = state.startedAt + cfg.globalMin*60*1000;
        state.timers.global = setInterval(()=>{
          const left = Math.max(0, ((end - Date.now())/1000)|0);
          $('globalTimer').textContent = fmtSec(left);
          if(left<=0){ clearInterval(state.timers.global); finish(); }
        }, 250);
      }else{
        state.timers.global = setInterval(()=>{
          const elapsed = ((Date.now()-state.startedAt)/1000)|0;
          $('globalTimer').textContent = fmtSec(elapsed);
        }, 250);
      }

      renderQuestion(true);
    }

    function startQuestionClock(){
      const cfg = MODES[state.mode];
      clearInterval(state.timers.perQ);
      state.qStartedAt = Date.now();

      state.timers.perQ = setInterval(()=>{
        const elapsed = ((Date.now()-state.qStartedAt)/1000)|0;
        $('questionTimer').textContent = fmtSec(elapsed);

        // Hard cap only if timePerQ set (triage/speed)
        if(cfg.timePerQ){
          const left = cfg.timePerQ - elapsed;
          if(left<=0){
            recordTimeForCurrent();
            state.skipped.add(state.index);
            clearInterval(state.timers.perQ);
            if(cfg.autoAdvance){
              nextQuestion();
            }else{
              $('submitBtn').style.display='none';
              $('nextBtn').style.display='block';
            }
            return;
          }
        }

        // Pace coaching
        const delta = overallDelta(cfg, elapsed); // + behind, - ahead
        const ind = $('paceIndicator'); const val = $('paceValue');

        // Current question warning when over perQWarn (e.g., 90s for exam)
        if(cfg.perQWarn && elapsed > cfg.perQWarn){
          ind.className='pace-indicator pace-danger';
          ind.textContent=`OVER ${cfg.perQWarn}s`;
          val.textContent = `+${elapsed-cfg.perQWarn}s | Œî ${delta>=0?'+':'-'}${deltaClock(delta)}`;
        }else{
          if(delta > 15){ ind.className='pace-indicator pace-behind'; ind.textContent='BEHIND'; }
          else if(delta < -15){ ind.className='pace-indicator pace-on-track'; ind.textContent='AHEAD'; }
          else { ind.className='pace-indicator pace-on-track'; ind.textContent='ON TRACK'; }
          val.textContent = `Œî ${delta>=0?'+':'-'}${deltaClock(delta)}`;
        }
      }, 1000);
    }

    function recordTimeForCurrent(){
      const secs = ((Date.now()-state.qStartedAt)/1000)|0;
      state.perQTimes[state.index] += secs;
    }

    function renderQuestion(first=false){
      const q = state.questions[state.index];
      if(!q){ finish(); return; }

      $('domainBadge').textContent = q.domain || 'Domain';
      const diff = (q.difficulty||'medium').toLowerCase();
      const db = $('difficultyBadge');
      db.textContent = diff[0].toUpperCase()+diff.slice(1);
      db.className = 'badge ' + (diff==='easy'?'badge-difficulty-easy':diff==='hard'?'badge-difficulty-hard':'badge-difficulty-medium');
      $('questionNumber').textContent = `Q${state.index+1} of ${state.questions.length}`;
      $('scenario').textContent = q.scenario || '';
      $('questionText').textContent = q.question || '';

      const wrap = $('options'); wrap.innerHTML='';
      const letters='ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      (q.options||[]).forEach((opt,i)=>{
        const div=document.createElement('div');
        div.className='option';
        div.onclick=()=>selectOption(i);
        div.innerHTML=`<div class="option-letter">${letters[i]}</div><div class="option-text">${opt}</div>`;
        if(state.answers[state.index]===i) div.classList.add('selected');
        wrap.appendChild(div);
      });

      $('explanation').style.display='none';
      $('submitBtn').style.display='block';
      $('nextBtn').style.display='none';

      startQuestionClock();

      if(first){
        $('paceIndicator').className='pace-indicator pace-on-track';
        $('paceIndicator').textContent='ON TRACK';
        $('paceValue').textContent='Œî +0m 00s';
      }
    }

    function selectOption(i){
      state.answers[state.index]=i;
      [...$('options').children].forEach((el,idx)=>el.classList.toggle('selected', idx===i));
    }

    function submitAnswer(){
      const q=state.questions[state.index];
      if(state.answers[state.index]==null){ alert('Select an answer or Skip.'); return; }
      recordTimeForCurrent();
      clearInterval(state.timers.perQ);

      const chosen=state.answers[state.index];
      [...$('options').children].forEach((el,idx)=>{
        el.classList.remove('selected');
        el.classList.add(idx===q.correct?'correct':(idx===chosen?'incorrect':''));
      });
      if(chosen===q.correct) state.correctCount++;

      $('correctExplanation').textContent = (q.explanation && (q.explanation.correct||q.explanation)) || '';
      $('strategyTip').textContent = (q.explanation && (q.explanation.examStrategy||'')) || '';
      $('explanation').style.display='block';
      $('submitBtn').style.display='none';
      $('nextBtn').style.display='block';
    }

    function nextQuestion(){
      clearInterval(state.timers.perQ);
      if(state.index < state.questions.length-1){ state.index++; renderQuestion(); }
      else { finish(); }
    }
    function previousQuestion(){
      clearInterval(state.timers.perQ);
      if(state.index>0){ state.index--; renderQuestion(); }
    }
    function skipQuestion(){
      recordTimeForCurrent();
      state.skipped.add(state.index);
      nextQuestion();
    }
    function toggleFlag(){
      if(state.flagged.has(state.index)) state.flagged.delete(state.index);
      else state.flagged.add(state.index);
    }

    function finish(){
      clearInterval(state.timers.global); clearInterval(state.timers.perQ);
      $('questionContainer').style.display='none';
      $('resultsContainer').style.display='block';

      const total=state.questions.length;
      const pct = Math.round((state.correctCount/total)*100);
      $('scoreText').textContent=`${pct}%`;
      $('correctCount').textContent=`${state.correctCount}/${total}`;
      const elapsed = ((Date.now()-state.startedAt)/1000)|0;
      $('timeUsed').textContent=fmtSec(elapsed);
      $('flaggedCount').textContent=state.flagged.size;
    }

    // Expose a clean reset
    function resetQuiz(){
      clearInterval(state.timers.global); clearInterval(state.timers.perQ);
      state.mode=null; state.questions=[]; state.index=0; state.answers=[]; state.flagged.clear(); state.skipped.clear();
      $('resultsContainer').style.display='none';
      $('questionContainer').style.display='none';
      $('timerSection').style.display='none';
      $('modeSelection').style.display='grid';
      $('globalTimer').textContent='00:00';
      $('questionTimer').textContent='00:00';
      $('paceIndicator').className='pace-indicator pace-on-track';
      $('paceIndicator').textContent='ON TRACK';
      $('paceValue').textContent='--';
      window.scrollTo(0,0);
    }

    // Public API
    window.startMode = startMode;
    window.resetQuiz = resetQuiz;
    window.reviewAnswers = () => alert('Detailed review coming next build.');

  </script>
</body>
</html>
