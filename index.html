<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#FF9900" />
  <title>AWS DVA-C02 Strategic Exam Trainer</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{
      --primary:#FF9900;--primary-dark:#FF6600;--success:#28a745;--warning:#ffc107;--danger:#dc3545;--aws-blue:#0073bb;
      --card:rgba(255,255,255,.12);--card2:rgba(255,255,255,.18);--text:#fff
    }
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Ubuntu;
      min-height:100vh;background:linear-gradient(135deg,#FF6B00 0%,#FF9900 100%);
      color:var(--text);display:flex;flex-direction:column;align-items:center}
    .main-header{width:100%;padding:36px 20px;text-align:center;background:rgba(0,0,0,.08)}
    .main-header h1{font-size:2.6rem;font-weight:900}
    .container{width:100%;max-width:1100px;padding:0 20px 60px}
    .features-card{background:var(--card);border:1px solid rgba(255,255,255,.2);
      border-radius:20px;padding:24px;margin:18px 0;backdrop-filter:blur(8px)}
    .mode-selection{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:18px}
    .mode-card{background:var(--card2);border:1px solid rgba(255,255,255,.25);
      padding:24px;border-radius:18px;cursor:pointer;transition:.2s}
    .mode-card:hover{transform:translateY(-6px)}
    .timer-section{display:none;gap:14px;margin:18px 0}
    .timer-box{flex:1;min-width:180px;background:var(--card2);padding:14px;border-radius:14px;text-align:center}
    .question-container,.results-container{display:none;background:#fff;color:#333;border-radius:18px;padding:22px;box-shadow:0 10px 34px rgba(0,0,0,.18)}
    .badge{padding:6px 10px;border-radius:999px;font-weight:700;font-size:.8rem;color:#fff}
    .bd1{background:var(--primary)}.bdE{background:var(--success)}.bdM{background:var(--warning)}.bdH{background:var(--danger)}
    .action-btn{border:0;border-radius:999px;padding:8px 14px;color:#fff;font-weight:700;cursor:pointer}
    .flag{background:var(--warning)}.skip{background:var(--primary)}
    .scenario{background:#fff6ec;border-left:4px solid var(--primary);padding:12px;border-radius:10px;margin:10px 0}
    .options{display:flex;flex-direction:column;gap:10px;margin-top:10px}
    .option{border:2px solid #e5e5e5;border-radius:12px;padding:12px;display:flex;gap:10px;cursor:pointer}
    .option:hover{border-color:#ffb14d}.option.selected{background:#fff1da;border-color:#ffb14d}
    .option.correct{background:#e8f9ed;border-color:#28a745}.option.incorrect{background:#ffe8ea;border-color:#dc3545}
    .letter{width:28px;height:28px;border-radius:999px;display:flex;align-items:center;justify-content:center;background:#0073bb;color:#fff;font-weight:800}
    .explanation{display:none;background:#f5faff;border:1px solid #d1e7ff;border-radius:12px;padding:14px;margin-top:12px}
    .controls{display:flex;gap:10px;margin-top:16px}
    .btn{flex:1;border:0;border-radius:999px;padding:12px 18px;color:#fff;font-weight:800;cursor:pointer}
    .btn.primary{background:linear-gradient(135deg,var(--primary),var(--primary-dark))}
    .btn.secondary{background:linear-gradient(135deg,#6c757d,#5a6268)}
    .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin:18px 0}
    .stat-card{background:#f7f7f7;border-radius:12px;padding:16px;text-align:center}
    .score-circle{width:150px;height:150px;margin:0 auto 12px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:900;font-size:2.2rem;background:conic-gradient(var(--primary) 0deg,var(--primary) var(--deg),#e0e0e0 var(--deg))}
    .score-text{width:120px;height:120px;border-radius:50%;background:#fff;color:#333;display:flex;align-items:center;justify-content:center}
    .pass{color:#28a745;font-weight:900}.fail{color:#dc3545;font-weight:900}
    .error-card{background:#fff3cd;color:#6b4e00;border:2px dashed #ffdd57;border-radius:16px;padding:18px;margin:18px 0}
  </style>
</head>
<body>
  <header class="main-header">
    <h1>üéØ AWS DVA-C02 Strategic Exam Trainer</h1>
    <p>Master exam timing & strategy with 500+ realistic scenarios.</p>
  </header>

  <main class="container">
    <section class="features-card">
      <h3>üéí Professional Question Bank</h3>
      <p>Security ‚Ä¢ Deployment ‚Ä¢ Performance ‚Ä¢ Cost optimization</p>
    </section>

    <section id="bankError" class="error-card" style="display:none"></section>

    <section id="modeSelection" class="mode-selection">
      <div class="mode-card" data-mode="triage"><b>‚ö° Triage Training</b><p>Spot quick wins vs time sinks.</p></div>
      <div class="mode-card" data-mode="speed"><b>üî• Speed Rounds</b><p>90-second cap per question.</p></div>
      <div class="mode-card" data-mode="exam"><b>üéØ Full Exam</b><p>65 Q ¬∑ 130 min ¬∑ realistic difficulty.</p></div>
      <div class="mode-card" data-mode="strategic"><b>üß† Strategic Practice</b><p>Mark/skip/return flows.</p></div>
    </section>

    <section id="timerSection" class="timer-section">
      <div class="timer-box"><div>Global</div><div id="globalTimer" style="font-weight:800;font-size:1.6rem">00:00</div></div>
      <div class="timer-box"><div>Question</div><div id="questionTimer" style="font-weight:800;font-size:1.6rem">00:00</div></div>
      <div class="timer-box"><div>Pace</div><div id="paceValue" style="font-weight:800;font-size:1.6rem">‚Äî</div></div>
    </section>

    <section id="questionContainer" class="question-container">
      <div style="display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap">
        <div style="display:flex;gap:8px">
          <span id="domainBadge" class="badge bd1">Domain</span>
          <span id="difficultyBadge" class="badge bdM">Medium</span>
          <span id="questionNumber" class="badge" style="background:#333;color:#fff">Q1</span>
        </div>
        <div style="display:flex;gap:8px">
          <button id="flagBtn" class="action-btn flag">üö© Flag</button>
          <button id="skipBtn" class="action-btn skip">‚è≠Ô∏è Skip</button>
        </div>
      </div>

      <div id="scenario" class="scenario"></div>
      <div id="questionText" style="font-size:1.1rem;font-weight:800;margin:10px 0"></div>
      <div id="options" class="options"></div>

      <div id="explanation" class="explanation">
        <h4>‚úÖ Correct Answer</h4><p id="correctExplanation"></p>
        <h4>‚ùå Why Others Are Wrong</h4><div id="wrongExplanations"></div>
        <h4>üí° Strategy Tip</h4><p id="strategyTip"></p>
      </div>

      <div class="controls">
        <button id="prevBtn" class="btn secondary">Previous</button>
        <button id="submitBtn" class="btn primary">Submit Answer</button>
        <button id="nextBtn" class="btn primary" style="display:none">Next Question</button>
      </div>
    </section>

    <section id="resultsContainer" class="results-container">
      <div style="text-align:center">
        <div id="scoreCircle" class="score-circle" style="--deg:0deg"><div id="scoreText" class="score-text">0%</div></div>
        <div id="passFail" class="fail">RESULT</div>
      </div>
      <div class="stats-grid">
        <div class="stat-card"><div>Correct Answers</div><div id="correctCount" class="stat-value">0/0</div></div>
        <div class="stat-card"><div>Total Minutes</div><div id="timeUsed" class="stat-value">0</div></div>
        <div class="stat-card"><div>Avg Time/Question</div><div id="avgTime" class="stat-value">0s</div></div>
        <div class="stat-card"><div>Slowest</div><div id="slowestTime" class="stat-value">‚Äî</div></div>
        <div class="stat-card"><div>Fastest</div><div id="fastestTime" class="stat-value">‚Äî</div></div>
        <div class="stat-card"><div>Flagged / Skipped</div><div class="stat-value"><span id="flaggedCount">0</span> / <span id="skippedCount">0</span></div></div>
      </div>
      <div class="controls">
        <button id="reviewBtn" class="btn primary">Detailed Review</button>
        <button id="newSessionBtn" class="btn secondary">Start New Session</button>
        <button id="anotherExamBtn" class="btn primary">Take Another Exam</button>
      </div>
    </section>
  </main>

  <!-- (Optional) Soft wallet sanitiser to avoid extension redefinition errors -->
  <script>
    (function(){
      ['ethereum','tronWeb','solana','walletRouter'].forEach(p=>{
        try{ if(!(p in window)) Object.defineProperty(window,p,{get:()=>undefined,set:v=>v,configurable:true}); }catch(_){}
      });
      const orig=document.createElement; document.createElement=function(t){const el=orig.call(document,t);
        if(String(t).toLowerCase()==='script'){const s=el.setAttribute; el.setAttribute=function(n,v){
          if(n==='src'&&String(v).startsWith('chrome-extension://')) return; return s.call(this,n,v);
        }}
        return el;
      };
    })();
  </script>

  <!-- üëá Load YOUR questions (defines window.questionBank = [ ‚Ä¶ ]) -->
  <script src="./questions.js?v=1"></script>

  <!-- Small fallback demo so the UI still shows if questionBank fails -->
  <script>
    const __fallbackDemo = [{
      id:'demo_01', domain:'Deployment', difficulty:'Medium',
      scenario:'Zero-downtime Lambda deployment needed.',
      question:'Best approach?',
      options:['In-place update','Versions + alias traffic shifting','Delete & recreate','Change memory'],
      correct:1,
      explanation:{correct:'Use versions + alias shifting (or CodeDeploy).',
        whyWrong:{0:'Risky partial rollout',2:'Downtime',3:'Does not shift traffic'},
        examStrategy:'Prefer canary/linear with aliases.'}
    }];
  </script>

  <script>
    /* ------------ Loader + diagnostics ------------- */
    const $ = id => document.getElementById(id);
    const Views = { analysis:['modeSelection'], exam:['timerSection','questionContainer'], results:['resultsContainer'] };
    const A='ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    const mmss = s => `${String(Math.floor(s/60)).padStart(2,'0')}:${String(s%60).padStart(2,'0')}`;

    function reportBankProblem(title, detail) {
      const el=$('bankError');
      el.style.display='block';
      el.innerHTML = `<b>‚ö†Ô∏è ${title}</b><br>${detail||''}`;
    }

    function loadQuestionsFromBank(){
      try{
        let qb = window.questionBank;
        if (!qb) return null;
        if (!Array.isArray(qb) && typeof qb==='object'){
          const flat=[]; for (const k in qb) if (Array.isArray(qb[k])) flat.push(...qb[k]); qb=flat;
        }
        if (!Array.isArray(qb) || !qb.length) return null;
        const out = qb.map(q=>{
          const ci = typeof q.correct==='string' ? A.indexOf((q.correct||'').toUpperCase()) : q.correct;
          const whyWrong = (q.explanation && q.explanation.whyWrong) || {};
          const wrong = Array.isArray(q.options) ? q.options.map((_,i)=> i===ci?'': (whyWrong[i]??whyWrong[String(i)]??'')) : [];
          return {
            id:q.id||'', domain:q.domain||'General', difficulty:q.difficulty||'Medium',
            timeRecommendation:q.timeRecommendation||null,
            scenario:q.scenario||'', question:q.question||'', options:q.options||[],
            correct:Number.isInteger(ci)?ci:0,
            why:(q.explanation && (q.explanation.correct||'')) || '',
            wrong, tip:(q.explanation && q.explanation.examStrategy) || ''
          };
        }).filter(q=>Array.isArray(q.options)&&q.options.length>=2);
        return out.length?out:null;
      }catch(e){ reportBankProblem('Error parsing questionBank', e.message); return null; }
    }
  </script>

  <script>
    /* ------------------- Trainer engine ------------------- */
    const state = { mode:null, questions:[], index:0, answers:[], flagged:new Set(), skipped:new Set(), times:[], startTs:null, qStartTs:null, gTimer:null, qTimer:null };

    function show(view){
      Object.values(Views).flat().forEach(id=>$(id).style.display='none');
      (Views[view]||[]).forEach(id=>$(id).style.display=id==='timerSection'?'flex':'block');
      window.scrollTo(0,0);
    }

    function startExam(mode='exam'){
      const loaded = loadQuestionsFromBank();
      if (!loaded) {
        reportBankProblem((typeof window.questionBank==='undefined')?'questionBank is undefined':'questionBank has 0 valid items',
                          'Using one demo question so you can see the flow.');
        state.questions = __fallbackDemo.slice();
      } else {
        state.questions = loaded;
      }
      state.mode=mode; state.index=0;
      state.answers = Array(state.questions.length).fill(null);
      state.flagged.clear(); state.skipped.clear(); state.times=[];
      clearInterval(state.gTimer); clearInterval(state.qTimer);
      state.startTs=Date.now(); state.qStartTs=Date.now();
      $('globalTimer').textContent='00:00'; $('questionTimer').textContent='00:00';
      show('exam'); renderQuestion();
      state.gTimer=setInterval(updateTimers,1000); state.qTimer=setInterval(updateTimers,1000);
    }

    function updateTimers(){
      const now=Date.now();
      const gs=Math.max(0,Math.round((now-(state.startTs||now))/1000));
      const qs=Math.max(0,Math.round((now-(state.qStartTs||now))/1000));
      $('globalTimer').textContent=mmss(gs); $('questionTimer').textContent=mmss(qs);
    }

    function renderQuestion(){
      const q = state.questions[state.index]; if(!q){ return finishExam(); }
      $('domainBadge').textContent=q.domain||'Domain';
      const dif=(q.difficulty||'Medium').toLowerCase();
      $('difficultyBadge').className='badge '+(dif==='easy'?'bdE':dif==='hard'?'bdH':'bdM');
      $('difficultyBadge').textContent=(q.difficulty||'Medium').toString();
      $('questionNumber').textContent=`Q${state.index+1} of ${state.questions.length}`;
      $('scenario').textContent=q.scenario||'';
      $('questionText').textContent=q.question||'';
      $('explanation').style.display='none';

      const box=$('options'); box.innerHTML='';
      q.options.forEach((t,i)=>{
        const d=document.createElement('div'); d.className='option';
        if(state.answers[state.index]===i) d.classList.add('selected');
        d.innerHTML=`<div class="letter">${String.fromCharCode(65+i)}</div><div>${t}</div>`;
        d.onclick=()=>{[...box.children].forEach(x=>x.classList.remove('selected')); d.classList.add('selected'); state.answers[state.index]=i;};
        box.appendChild(d);
      });

      $('prevBtn').disabled = state.index===0;
      state.qStartTs=Date.now();
    }

    function saveTime(){ const ms=Math.max(0,Date.now()-state.qStartTs); state.times[state.index]=(state.times[state.index]||0)+ms; state.qStartTs=Date.now(); }
    function prevQuestion(){ saveTime(); if(state.index>0){ state.index--; renderQuestion(); } }
    function nextQuestion(){ saveTime(); if(state.index<state.questions.length-1){ state.index++; renderQuestion(); } else { finishExam(); } }
    function skipQuestion(){ state.skipped.add(state.index); nextQuestion(); }
    function toggleFlag(){ state.flagged.has(state.index)?state.flagged.delete(state.index):state.flagged.add(state.index); }

    function submitAnswer(){
      const q = state.questions[state.index]; const sel=state.answers[state.index];
      const opts=[...$('options').children];
      opts.forEach((el,i)=>{ el.classList.remove('correct','incorrect'); if(i===q.correct) el.classList.add('correct'); if(sel!=null && i===sel && sel!==q.correct) el.classList.add('incorrect'); });
      $('correctExplanation').textContent=q.why||'';
      const w=$('wrongExplanations'); w.innerHTML=''; (q.wrong||[]).forEach((txt,i)=>{ if(!txt) return; const p=document.createElement('p'); p.textContent=`${String.fromCharCode(65+i)}: ${txt}`; w.appendChild(p); });
      $('strategyTip').textContent=q.tip||'';
      $('explanation').style.display='block';
      $('submitBtn').style.display='none'; $('nextBtn').style.display='inline-block';
    }

    function finishExam(){
      saveTime(); clearInterval(state.gTimer); clearInterval(state.qTimer);
      const total=state.questions.length||0;
      const correct=state.answers.reduce((n,a,i)=>n+(a===state.questions[i]?.correct?1:0),0);
      const pct=Math.round((correct/Math.max(1,total))*100);
      const deg=Math.round(pct*3.6);
      $('scoreCircle').style.setProperty('--deg',`${deg}deg`); $('scoreText').textContent=`${pct}%`;
      const pass=pct>=72; const pf=$('passFail'); pf.textContent=pass?'PASS':'FAIL'; pf.className=pass?'pass':'fail';
      $('correctCount').textContent=`${correct}/${total}`;
      const totalMs=(state.times||[]).reduce((a,b)=>a+(b||0),0);
      const answered=state.answers.filter(a=>a!=null).length;
      $('timeUsed').textContent=String(Math.round(totalMs/60000));
      $('avgTime').textContent= answered?`${Math.round((totalMs/answered)/1000)}s`:'0s';
      const times=(state.times||[]).filter(v=>Number.isFinite(v)&&v>0);
      $('slowestTime').textContent=times.length?`${Math.round(Math.max(...times)/1000)}s`:'‚Äî';
      $('fastestTime').textContent=times.length?`${Math.round(Math.min(...times)/1000)}s`:'‚Äî';
      $('flaggedCount').textContent=state.flagged.size; $('skippedCount').textContent=state.skipped.size;
      show('results');
    }

    // Wire UI
    document.addEventListener('DOMContentLoaded',()=>{
      document.querySelectorAll('.mode-card').forEach(c=>c.addEventListener('click',()=>startExam(c.dataset.mode||'exam')));
      $('flagBtn').onclick=toggleFlag; $('skipBtn').onclick=skipQuestion;
      $('prevBtn').onclick=prevQuestion; $('submitBtn').onclick=submitAnswer; $('nextBtn').onclick=nextQuestion;
      $('reviewBtn').onclick=()=>{ show('exam'); state.index = state.flagged.size?[...state.flagged][0]:0; renderQuestion(); };
      $('newSessionBtn').onclick=()=>{ clearInterval(state.gTimer); clearInterval(state.qTimer); show('analysis'); };
      $('anotherExamBtn').onclick=()=>startExam('exam');

      // Show visible error if bank missing at load
      if (!loadQuestionsFromBank()) {
        reportBankProblem(
          (typeof window.questionBank==='undefined') ? 'questionBank is undefined' : 'questionBank has 0 valid questions',
          'Ensure questions.js sets window.questionBank = [ ‚Ä¶ ] and is included before these scripts (no type="module").'
        );
      }
    });
  </script>
</body>
</html>
